<link rel="import" href="../bower_components/polymer/polymer.html">

<dom-module id="ls-new-post">
  <style>
    :host ::content paper-fab {
      position: fixed;
      bottom: 20px;
      right: 20px;
    }

    :host paper-dialog {
      width: 50%;
    }

    :host ::content paper-button.green {
      background: var(--google-green-500);
      color: white;
    }
  </style>

  <template>
    <paper-fab icon="add" on-tap="toggleDialog"></paper-fab>

    <paper-dialog
      with-backdrop
      opened="{{enabled}}"
      entry-animation="scale-up-animation"
      exit-animation="fade-out-animation"
    >
      <paper-dialog-scrollable>
        <h2>What's in your mind?</h2>

        <form
          action="[[post_url]]"
          is="iron-form"
          method="post"
          id="new_post"
        >

          <input
            value="{{authValue}}"
            name="authenticity_token"
            type="hidden"
          ></input>

          <paper-input name="post[title]" label="Title"></paper-input>
          <paper-textarea name="post[content]" label="Content go here"></paper-input>
        </form>

      </paper-dialog-scrollable>

      <div class="buttons">
        <paper-button dialog-dismiss>Cancel</paper-button>
        <paper-button raised on-tap="submitForm" class="green">Post</paper-button>
      </div>
    </paper-dialog>
  </template>

  <script>
    Polymer({
      is: 'ls-new-post',
      properties: {
        url: String,
        post_url: {
          type: String,
          computed: "postURL(url)"
        },
        enable: {
          type: Boolean,
          value: false
        },
        authValue: {
          type: String,
        }
      },
      postURL: function(url) {
        return url + "/posts";
      },
      toggleDialog: function() {
        this.enabled = !this.enabled;
      },
      submitForm: function(e) {
        this.$.new_post.submit();
      },
      ready: function() {
        this.authValue = document.querySelector("meta[name=csrf-token]").content;
      }
    })
  </script>
</dom-module>
